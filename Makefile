CXX=/usr/local/opt/llvm/bin/clang++
#CXXFLAGS=-Wall -Wextra -Wno-deprecated-declarations -O0 -fno-rtti -fno-exceptions -march=native -fsanitize=address -fsanitize=undefined -fno-omit-frame-pointer -g -std=c++14 -stdlib=libc++ -Isrc -MMD
CXXFLAGS=-Wall -Wextra -Wno-deprecated-declarations -O3 -fno-rtti -fno-exceptions -march=native -std=c++14 -stdlib=libc++ -Isrc -MMD

.PHONY: clean regen all

all: regen report.docx report.html report.pdf

regen: Bugs Bugs-cli
	awk '{ print } /^# AUTOGENERATED/ { exit }' Makefile > Makefile.new
	cat src/*.d test/*.d >> Makefile.new
	mv -f Makefile.new Makefile

clean:
	-rm -f Bugs
	-find . \( -name '*.o' -o -name '*.d' \) -delete

Bugs: src/Actor.o src/GameController.o src/GameWorld.o src/main.o src/StudentWorld.o
	$(CXX) $(CXXFLAGS) -framework OpenGL $^ /opt/X11/lib/libglut.dylib -o $@

Bugs-cli: test/main.o test/Actor.o test/StudentWorld.o test/GameWorld.o
	$(CXX) $(CXXFLAGS) $^ -o $@

report.docx: report.txt
	pandoc --toc --smart --standalone --from markdown+inline_code_attributes -o $@ $<

report.html: report.txt
	pandoc --toc --smart --standalone --self-contained --from markdown+inline_code_attributes -o $@ $<

report.pdf: report.txt
	pandoc --toc --smart --standalone --variable=geometry:letterpaper,margin=1in --from markdown+inline_code_attributes -o $@ $<

test/Actor.h: src/Actor.h
	cp -f $^ $@

test/Actor.cpp: src/Actor.cpp
	cp -f $^ $@

test/StudentWorld.h: src/StudentWorld.h
	cp -f $^ $@

test/StudentWorld.cpp: src/StudentWorld.cpp
	cp -f $^ $@

# AUTOGENERATED DEPENDENCIES BELOW
src/Actor.o: src/Actor.cpp src/Actor.h src/Compiler.h src/GameConstants.h \
  src/GraphObject.h src/SpriteManager.h src/freeglut.h \
  src/freeglut_std.h src/freeglut_ext.h src/StudentWorld.h src/Field.h \
  src/GameWorld.h
src/GameController.o: src/GameController.cpp src/freeglut.h \
  src/freeglut_std.h src/freeglut_ext.h src/GameController.h \
  src/SpriteManager.h src/GameConstants.h src/GameWorld.h \
  src/GraphObject.h src/SoundFX.h
src/GameWorld.o: src/GameWorld.cpp src/GameWorld.h src/GameConstants.h \
  src/GameController.h src/SpriteManager.h src/freeglut.h \
  src/freeglut_std.h src/freeglut_ext.h
src/StudentWorld.o: src/StudentWorld.cpp src/StudentWorld.h \
  src/Compiler.h src/GameConstants.h src/Field.h src/GameWorld.h \
  src/Actor.h src/GraphObject.h src/SpriteManager.h src/freeglut.h \
  src/freeglut_std.h src/freeglut_ext.h
src/main.o: src/main.cpp src/GameController.h src/SpriteManager.h \
  src/freeglut.h src/freeglut_std.h src/freeglut_ext.h \
  src/GameConstants.h
test/Actor.o: test/Actor.cpp test/Actor.h src/Compiler.h \
  src/GameConstants.h test/GraphObject.h test/StudentWorld.h src/Field.h \
  src/GameWorld.h
test/GameWorld.o: test/GameWorld.cpp src/GameWorld.h src/GameConstants.h
test/StudentWorld.o: test/StudentWorld.cpp test/StudentWorld.h \
  src/Compiler.h src/GameConstants.h src/Field.h src/GameWorld.h \
  test/Actor.h test/GraphObject.h
test/main.o: test/main.cpp src/GameWorld.h src/GameConstants.h
